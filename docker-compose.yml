version: "3.9"

services:

   # Research of NNs for whole solution
   model-notebook:
      build:
         context: ./model
      ports: 
         - 8890:8890
         - 6006:6006
      runtime: nvidia
      volumes:
         - ./model:/work/.

      depends_on: 
         - elasticsearch
      links:
         - elasticsearch

   elasticsearch:
      image: docker.elastic.co/elasticsearch/elasticsearch:7.13.4
      ports:
         - 9200:9200
         - 9300:9300
      volumes:
         - elasticsearch_data:/usr/share/elasticsearch/data
      environment:
         ES_JAVA_OPTS: "-Xmx256m -Xms256m"
         ELASTIC_PASSWORD: pass
         # Use single node discovery in order to disable production mode and avoid bootstrap checks.
         # see: https://www.elastic.co/guide/en/elasticsearch/reference/current/bootstrap-checks.html
         discovery.type: single-node

   # Search engine lambda
   search:
      build:
         context: ./search
         dockerfile: ./dev.Dockerfile
      ports:
         - 8894:8894
         - 8895:8895
      volumes:
         - ./search/:/app/.
      env_file:
         ./search/.env


volumes:
   elasticsearch_data:
      driver: local
